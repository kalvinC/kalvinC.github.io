<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Kalvinc.GitHub.io</title>
  <meta name="Description" content="Kalvinc.GitHub.io : ">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1347.57">
 
  <script src="../../javascripts/jquery-1.11.2.min.js"  type="javascript"></script>
  <script src="../../javascripts/bootstrap.min.js" type="javascript"></script>
  
  <link rel="stylesheet" href="../../stylesheets/bootstrap.min.css">
  
</head>
<body>
  <div class="container-fluid">
    <nav class="navbar navbar-inverse">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
        </button>
        <a class="navbar-brand" href="#">KalvinC</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="../../index.html">Home</a></li>
          <li><a href="../Articles/index1.html">Articles</a></li>
          <li><a href="../Thoughts/index1.html">Thoughts</a></li>
          <li><a href="../Resources/index1.html">Resources</a></li>
          <li><a href="../About/kalvin.html">About</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </nav>
  </div>

  <!--主要页面内容-->

  <div class="container-fluid">
    <h3 align="center">Redis源码阅读（2）-- Zmolloc的封装</h3>
  
    <p>我将跟随redis编译文件来阅读redis的源代码。这篇我们将阅读zmollloc文件。</p>
    <p>zmolloc.h定义</p>
    <pre>
      #define __xstr(s) __str(s) 
      #define __str(s) #s  //#s将s作为字符串输出，也就是说对s变成“s”
      
      #if defined(USE_TCMALLOC)
      #define ZMALLOC_LIB ("tcmalloc-" __xstr(TC_VERSION_MAJOR) "." __xstr(TC_VERSION_MINOR))
      #include <google/tcmalloc.h>
      #if (TC_VERSION_MAJOR == 1 && TC_VERSION_MINOR >= 6) || (TC_VERSION_MAJOR > 1)
      #define HAVE_MALLOC_SIZE 1
      #define zmalloc_size(p) tc_malloc_size(p)
      #else
      #error "Newer version of tcmalloc required"
      #endif

      /*
      上面一段代码，引入了google的一个tcmalloc.h的头文件
      */
    </pre>
    <div class="row"> <span class="col-md-offset-10 col-xs-offset-10 col-sm-offset-10 col-md-2 col-xs-2 col-sm-2">Noted by 2015-5-10</span></div>
  </div>

  <div class="commment-list">
    <H2>Comments</H2>
    <script type="text/javascript">
        (function(){
            var url = "http://widget.weibo.com/distribution/comments.php?width=0&url=auto&fontsize=14&ralateuid=2231787150&language=zh_cn&dpc=1";
            url = url.replace("url=auto", "url=" + document.URL);
            document.write('<iframe id="WBCommentFrame" src="' + url + '" scrolling="no" frameborder="0" style="width:100%"></iframe>');
            })();
            </script>
            <script src="http://tjs.sjs.sinajs.cn/open/widget/js/widget/comment.js" type="text/javascript" charset="utf-8"></script>
            <script type="text/javascript">
            window.WBComment.init({
                "id": "WBCommentFrame"
            });
    </script>
  </div>

<footer align="center"> @CopyRight by kalvin</footer>
</body>

</html>